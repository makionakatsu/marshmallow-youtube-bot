# 🔧 マシュマロ接続トラブルシューティング

## 🚨 「マシュマロに接続できません」の解決方法

### 1. **基本チェック**

#### ✅ マシュマロのページにアクセス
1. **正しいURL**: `https://marshmallow-qa.com/` にアクセス
2. **受信箱ページ**: ログイン後、受信箱ページに移動
3. **拡張機能のアイコン**: ページ上で拡張機能のアイコンをクリック

#### ✅ ログイン状態の確認
1. **マシュマロにログイン**: 必ずログインしてください
2. **受信箱の表示**: 質問一覧が表示されている状態
3. **ページリロード**: ログイン後、ページを1回リロード

### 2. **拡張機能の状態確認**

#### Chrome拡張機能管理画面
1. `chrome://extensions/` を開く
2. `Marshmallow to YouTube Bot` を探す
3. **✅ 有効になっている** ことを確認
4. **再読み込み**ボタンをクリック

#### 権限の確認
拡張機能の詳細で以下の権限が有効か確認：
- ✅ `https://marshmallow-qa.com/*`
- ✅ `https://www.googleapis.com/*`

### 3. **Content Scriptの動作確認**

#### 開発者ツールでの確認
1. **マシュマロページ**で`F12`を押す
2. **Console**タブを開く
3. 以下のメッセージが表示されるか確認：
   ```
   === Marshmallow Content Script V2.0 ===
   Content Script loaded successfully
   ```

#### 手動での接続状態確認
コンソールで以下を実行：
```javascript
// マシュマロアプリの状態確認
window.marshmallowV2?.getStatus()

// ログイン状態確認
document.querySelector('#inbox-count') !== null
```

### 4. **よくある問題と解決法**

#### 🔴 問題1: "Extension Context が無効"
**解決法:**
1. Chrome拡張機能ページで**再読み込み**
2. マシュマロページを**リロード**
3. 拡張機能を**無効→有効**に切り替え

#### 🔴 問題2: "Content Script が読み込まれない"
**解決法:**
1. `manifest.json`の`content_scripts`設定を確認
2. マシュマロページのURLが正しいか確認
3. 拡張機能の**再インストール**

#### 🔴 問題3: "ログイン状態が検出されない"
**解決法:**
1. マシュマロに**再ログイン**
2. **受信箱ページ**に移動
3. ページを**リロード**

### 5. **手動での接続テスト**

#### ステップ1: マシュマロページでの確認
1. `https://marshmallow-qa.com/` でログイン
2. 受信箱に移動
3. `#inbox-count` 要素が存在するか確認

#### ステップ2: 拡張機能での確認
1. 拡張機能のポップアップを開く
2. **マシュマロ接続状態**を確認
3. `disconnected` → `connected` に変わるか確認

### 6. **エラーメッセージ別の対処法**

#### "マシュマロ: 未接続"
- マシュマロページを開いていない
- ログインしていない
- Content Scriptが動作していない

#### "マシュマロ: ログアウト"
- マシュマロからログアウトしている
- セッションが期限切れ
- 再ログインが必要

#### "マシュマロ: 接続済み"
- 正常な状態
- 質問の自動取得が開始される

### 7. **完全なリセット手順**

問題が解決しない場合：

1. **拡張機能の完全リセット**
   ```
   chrome://extensions/ → 詳細 → 拡張機能データをクリア
   ```

2. **ブラウザの再起動**
   ```
   Chromeを完全に終了 → 再起動
   ```

3. **マシュマロの再ログイン**
   ```
   マシュマロからログアウト → 再ログイン → 受信箱に移動
   ```

### 8. **デバッグ情報の確認**

#### Background Script の状態確認
1. `chrome://extensions/` でデベロッパーモードを有効
2. `background page` をクリック
3. Console で以下を確認：
   ```javascript
   chrome.storage.local.get(['MARSHMALLOW_CONNECTION_STATUS'], console.log)
   ```

### 9. **正常な動作シーケンス**

1. **マシュマロページを開く** → `https://marshmallow-qa.com/`
2. **ログイン** → 認証情報を入力
3. **受信箱に移動** → 質問一覧が表示される
4. **Content Script 自動実行** → コンソールにメッセージ表示
5. **接続状態更新** → 拡張機能で "接続済み" 表示
6. **質問自動取得開始** → 30秒間隔で質問を監視

### 10. **サポート情報**

問題が継続する場合：
- Chrome バージョン: 最新版を使用
- マシュマロサイト: 正常に動作している
- 拡張機能バージョン: 2.0

---

**💡 ヒント**: ほとんどの接続問題は、マシュマロページでのログインとページリロードで解決します。